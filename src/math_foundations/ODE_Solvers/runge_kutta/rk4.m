% 四阶龙格-库塔方法（RK4）
% 输入：
%   f - 导数函数，形式为 f(t, y)，返回 dy/dt
%   t0 - 初始时间
%   y0 - 初始状态向量
%   t_end - 结束时间
%   h - 步长
% 输出：
%   t - 时间向量
%   y - 状态向量矩阵，每一行对应一个时间点的状态

function [t, y] = rk4(f, t0, y0, t_end, h)
    % 四阶龙格-库塔方法（RK4）
    % 输入：
    %   f - 导数函数，形式为 f(t, y)，返回 dy/dt
    %   t0 - 初始时间
    %   y0 - 初始状态向量
    %   t_end - 结束时间
    %   h - 步长
    % 输出：
    %   t - 时间向量
    %   y - 状态向量矩阵，每一行对应一个时间点的状态
    
    % 计算时间点数量
    n_steps = ceil((t_end - t0) / h);
    t = linspace(t0, t_end, n_steps + 1);
    
    % 初始化状态向量矩阵
    y = zeros(n_steps + 1, length(y0));
    y(1, :) = y0;
    
    % 四阶龙格-库塔迭代
    for i = 1:n_steps
        % 计算k1: 导数在当前点的值
        k1 = f(t(i), y(i, :)');
        
        % 计算k2: 导数在中点的值，使用k1更新状态
        k2 = f(t(i) + h/2, y(i, :)' + h*k1/2);
        
        % 计算k3: 导数在中点的值，使用k2更新状态
        k3 = f(t(i) + h/2, y(i, :)' + h*k2/2);
        
        % 计算k4: 导数在终点的值，使用k3更新状态
        k4 = f(t(i) + h, y(i, :)' + h*k3);
        
        % 计算下一个时间点的状态
        y(i+1, :) = y(i, :) + h*(k1 + 2*k2 + 2*k3 + k4)' / 6;
    end
end